/**
 * @name car-service
 * @description Easy and convenient way to register cars and their repairs.
 *
 * @version 1.0.0
 * @author Eleonora Atanasova
 * @license Apache-2.0
 */
var e,t,a,r,n,o,i,s=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},c=(e,t,a)=>(s(e,t,"read from private field"),a?a.call(e):t.get(e)),l=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},d=(e,t,a)=>(s(e,t,"access private method"),a);import{D as u,x as p,p as m,C as f,r as g,m as b,E as h,a as y}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();async function v(e,t){const a=new URL(e,"https://parseapi.back4app.com"),r=await fetch(a,t);if(!0!==r.ok){r.status>=400&&r.status<500&&await Q();const e=await r.json();throw new Error(`${e.message||e.error} Status: ${r.status}`,{cause:r})}return r.json()}function w(e,t){const a=new Headers({"X-Parse-Application-Id":"n4ufAUz9mhrjYKPDalloTzaHgwQxCzyclvXVLszh","X-Parse-REST-API-Key":"cRIv7Kag8w1bQvcXWXvj6qXeCghzgoLPm77xmGKb"}),r=G();return r&&a.append("X-Parse-Session-Token",r.token),t&&a.append("Content-Type","application/json"),{method:e,headers:a,...t?{body:JSON.stringify(t)}:{}}}const _=e=>v(e,w("GET")),$=(e,t)=>v(e,w("POST",t)),C=(e,t)=>v(e,w("PUT",t)),x=e=>v(e,w("DELETE")),k=new Map;function I(e){if(!e)return{};try{return decodeURIComponent(e).split("&").reduce(((e,t)=>{const[a,r]=t.split("=");return e[a.trim()]=(null==r?void 0:r.includes(","))?r.split(",").map(decodeURIComponent):decodeURIComponent(null==r?void 0:r.trim()),e}),{})}catch(t){return console.error(t),{}}}function N(e){if(!e)return"";try{return Object.entries(e).filter((([e,t])=>{const a="string"==typeof e&&e.trim().length>0,r="string"==typeof t?t.trim().length>0:Array.isArray(t)&&t.every((e=>"string"==typeof e&&e.trim().length>0));return a&&r})).map((([e,t])=>{const a=Array.isArray(t)?t.map((e=>encodeURIComponent(e.trim()))).join(","):encodeURIComponent(t.trim());return`${encodeURIComponent(e.trim())}=${a}`})).join("&")}catch(t){return console.error(t),""}}function S(e){const t=new FormData(e);return[Object.fromEntries(Array.from(t,(([e,t])=>[e,"string"==typeof t?t.trim():t]))),t=>Array.from(e.elements).forEach((e=>t?e.setAttribute("disabled","true"):e.removeAttribute("disabled")))]}function A(){if(crypto&&crypto.randomUUID)return crypto.randomUUID();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=~~(16*Math.random());return("x"===e?t:3&t|8).toString(16)}))}function R(e,t={}){const{parent:a,prepend:r=!1,attributes:n,children:o,style:i,...s}=t,c=document.createElement(e);if(void 0!==n)for(const l in n)c.setAttribute(l,n[l]);if(Array.isArray(o))for(const l of o)c.append(l);if(void 0!==i&&Object.assign(c.style,i),Object.assign(c,s),void 0!==a){const e="string"==typeof a?document.querySelector(a):a;e&&e[r?"prepend":"append"](c)}return c}const D=new Intl.NumberFormat("bg-BG",{style:"currency",currency:"BGN"});function L(e){return D.format(parseFloat(e||"0"))}function E(e,t="bg-BG"){try{return Intl.DateTimeFormat(t).format(new Date(e))}catch{return e.toString()}}function P(e){return`${e}T${function(e){const t=6e4*(new Date).getTimezoneOffset(),a=e&&Number(new Date(e).getTime()+t)||Date.now(),r=new Date(a-t).toISOString();return r.split("T")[1].slice(0,-5)}()}.000Z`}function T(e){const t=6e4*(new Date).getTimezoneOffset(),a=e&&Number(new Date(e).getTime()+t)||Date.now();return new Date(a-t).toISOString().split("T")[0]}const j={storageKeys:{userService:"car-service-current-user-data",memoization:"car-service-cache-initialized"},itemsPerPage:10,usersPerPage:5,relativePageLinks:3};e=new WeakMap;const O=new class{constructor(t){var a,r,n,o;l(this,e,void 0),n=t,s(a=this,r=e,"write to private field"),o?o.call(a,n):r.set(a,n),this.supported||console.warn("Cache API is not supported in this environment"),!sessionStorage.getItem(j.storageKeys.memoization)&&this.supported&&(sessionStorage.setItem(j.storageKeys.memoization,"true"),this.deleteCache())}get supported(){const e=G();return!!window.caches&&!!e&&!e.isSuperUser}get databaseName(){return c(this,e)}async getCacheData(t){if(!this.supported)return Promise.resolve(null);const a=await caches.open(c(this,e)),r=await a.match(new Request(t));return r&&r.ok?await r.json():Promise.resolve(null)}async updateCacheData(t,a){if(!this.supported)return Promise.resolve();return(await caches.open(c(this,e))).put(new Request(t),new Response(JSON.stringify(a)))}async clearCacheData(t){if(!this.supported)return Promise.resolve(!1);return(await caches.open(c(this,e))).delete(new Request(t))}async deleteCache(){return this.supported?caches.delete(c(this,e)):Promise.resolve(!1)}}("CarServiceCacheDatabase"),q="rgba(0 0 0 / 0.5)",M=3,z={default:{icon:"",color:"#555555",backgroundColor:"#f2f2f2"},info:{icon:"info",color:"#217ca3",backgroundColor:"#cfe8f3"},success:{icon:"check_circle",color:"#45874a",backgroundColor:"#e5f6e4"},warning:{icon:"error",color:"#b0822f",backgroundColor:"#fef5dc"},error:{icon:"cancel",color:"#b23c3a",backgroundColor:"#f2dede"}};t=new WeakMap,a=new WeakSet,r=function(e,t){switch(e){case"cube-flip":return R("div",{className:"notice-loading-cube-flip",style:{backgroundColor:t}});case"dots-zoom":return R("div",{className:"notice-loading-dots-zoom",children:[R("div",{className:"notice-loading-dots-zoom1",style:{backgroundColor:t}}),R("div",{className:"notice-loading-dots-zoom2",style:{backgroundColor:t}})]});case"line":return R("div",{className:"notice-loading-line",children:[R("div",{className:"notice-loading-line-rect1",style:{backgroundColor:t}}),R("div",{className:"notice-loading-line-rect2",style:{backgroundColor:t}}),R("div",{className:"notice-loading-line-rect3",style:{backgroundColor:t}}),R("div",{className:"notice-loading-line-rect4",style:{backgroundColor:t}}),R("div",{className:"notice-loading-line-rect5",style:{backgroundColor:t}})]});case"dots-spin":return R("div",{className:"notice-loading-spin-dots",children:[R("div",{className:"notice-loading-spin-dot1",style:{backgroundColor:t}}),R("div",{className:"notice-loading-spin-dot2",style:{backgroundColor:t}})]});case"dots":return R("div",{className:"notice-loading-dots",children:[R("div",{className:"notice-loading-dot1",style:{backgroundColor:t}}),R("div",{className:"notice-loading-dot2",style:{backgroundColor:t}}),R("div",{style:{backgroundColor:t}})]});case"cube-zoom":return R("div",{className:"notice-loading-cube-zoom",children:[R("div",{className:"notice-loading-cube-zoom-1",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-2",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-3",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-4",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-5",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-6",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-7",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-8",style:{backgroundColor:t}}),R("div",{className:"notice-loading-cube-zoom-9",style:{backgroundColor:t}})]});default:return null}},n=new WeakSet,o=function(e,t,a,r){const n=R("div",{className:"notice-modal-buttons"});switch(e){case"yes-no":return R("button",{parent:n,attributes:{"data-button-type":"info"},textContent:"Да",onclick:e=>{t.remove(),"function"==typeof a&&a(e)}}),R("button",{parent:n,attributes:{"data-button-type":"danger"},textContent:"Не",onclick:e=>{t.remove(),"function"==typeof r&&r(e)}}),n;case"ok":return R("button",{parent:n,textContent:"Добре",onclick:e=>{t.remove(),"function"==typeof a&&a(e)}}),n;case"ok-cancel":return R("button",{parent:n,textContent:"Добре",onclick:e=>{t.remove(),"function"==typeof a&&a(e)}}),R("button",{parent:n,attributes:{"data-button-type":"danger"},textContent:"Отказ",onclick:e=>{t.remove(),"function"==typeof r&&r(e)}}),n;case"retry-cancel":return R("button",{parent:n,attributes:{"data-button-type":"info"},textContent:"Нов опит",onclick:e=>{t.remove(),"function"==typeof a&&a(e)}}),R("button",{parent:n,attributes:{"data-button-type":"danger"},textContent:"Отказ",onclick:e=>{t.remove(),"function"==typeof r&&r(e)}}),n;default:return null}};const V=new class{constructor(){l(this,a),l(this,n),l(this,t,document.body)}showLoading(e={}){const{type:n="dots",color:o="white",autoClose:i,title:s,titleColor:l,maskColor:u=q}=e,p=R("div",{parent:c(this,t),className:"notice-loading notice-flex-center notice-fixed-all-page",id:"notice-loading"});R("div",{parent:p,className:"notice-mask notice-fixed-all-page",style:{backgroundColor:u}});const m=d(this,a,r).call(this,n,o)||d(this,a,r).call(this,"dots",o),f=R("div",{parent:p,className:"notice-flex-center notice-loading-main",children:[m]});s&&R("p",{parent:f,style:{color:l},textContent:s}),i&&setTimeout((()=>p.remove()),1e3*i)}hideLoading(){var e;null==(e=document.getElementById("notice-loading"))||e.remove()}showToast(e){const{text:a,type:r="default",autoClose:n=M,showClose:o=!0}=e;if(!a)return;const{icon:i,color:s,backgroundColor:l}=z[r]||z.default,d=document.getElementById("notice-toast")||R("div",{parent:c(this,t),className:"notice-toast",id:"notice-toast"}),u=R("div",{parent:d,className:"notice-toast-main notice-toast-main-active",id:`notice-toast-${A()}`,style:{backgroundColor:l}}),p=R("div",{parent:u,className:"notice-toast-container",children:[R("p",{className:"notice-toast-text",style:{color:s},textContent:a})]});i&&R("i",{parent:p,prepend:!0,className:"material-icons notice-toast-icon",style:{color:s},textContent:i}),(o||!n)&&R("i",{parent:p,className:"material-icons notice-close-icon",textContent:"close",onclick:()=>f()});const m=!!Number(getComputedStyle(d).getPropertyValue("--_should-auto-close"));if(n||m){setTimeout((()=>f()),1e3*(n||M))}function f(){if(!u)return;const e=parseFloat(window.getComputedStyle(u).getPropertyValue("transition-duration"));u.classList.remove("notice-toast-main-active"),setTimeout((()=>{u&&u.remove(),d.children.length||d.remove()}),1e3*e)}}showModal(e={}){const{type:a="yes-no",color:r,backgroundColor:i,title:s,titleColor:l,message:u,messageColor:p,maskColor:m=q,onConfirm:f,onCancel:g}=e,b=R("div",{parent:c(this,t),className:"notice-modal notice-flex-center notice-fixed-all-page",id:"notice-modal"});R("div",{parent:b,className:"notice-mask notice-fixed-all-page",style:{backgroundColor:m}});const h=R("div",{parent:b,className:"notice-flex-center notice-modal-main",style:{backgroundColor:i},children:[d(this,n,o).call(this,a,b,f,g)||d(this,n,o).call(this,"yes-no",b,f,g)]});u&&R("p",{parent:h,prepend:!0,style:{color:p||r},textContent:u}),s&&R("h2",{parent:h,prepend:!0,style:{color:l||r},textContent:s})}},U=document.querySelectorAll(".admin-navigation"),J=document.querySelectorAll(".user-navigation"),B=document.querySelectorAll(".guest-navigation");function F(e){const t=G(),a=t&&t.isSuperUser,r=e&&e.pathname.includes("/cars");U.forEach((e=>{!t||a?e.removeAttribute("hidden"):e.setAttribute("hidden","")})),J.forEach((n=>{t&&!a||a&&r?(n.removeAttribute("hidden"),a&&r&&function(e){const{userId:t}=e.params;J.forEach((e=>{Array.from(e.children).forEach((e=>{var a;const r=e.firstChild;if(r.id||(null==(a=r.getAttribute("href"))?void 0:a.includes("/admin")))return;const n=`/admin/${t}${r.getAttribute("href")}`;r.setAttribute("href",n)}))}))}(e)):a||n.setAttribute("hidden","")})),B.forEach((e=>{t?e.setAttribute("hidden",""):e.removeAttribute("hidden")}))}const H={LOGIN:"/functions/loginWithRoles",REGISTER:"/users",LOGOUT:"/logout",ALL_USERS:"/functions/getAllUsersWithRoles"},K={CREATE_CAR:"/classes/Car",ALL_CARS:(e="")=>`/classes/Car?${N({order:"-createdAt",where:e})}`,CAR_BY_ID:e=>`/classes/Car/${e}`},W={CREATE_REPAIR:"/classes/Repair",ALL_REPAIRS_BY_CAR:e=>`/classes/Repair?${N({order:"-date",where:e})}`,ALL_REPAIRS:`/classes/Repair?${N({order:"-date",include:"owner"})}`,REPAIR_BY_ID:e=>`/classes/Repair/${e}`};async function Y(e){const t=await $(H.ALL_USERS,{}),{result:a}=t,r=a.filter((e=>!e.roles.includes("Admin")));if(!e)return{results:r,count:r.length};const n=(e-1)*j.usersPerPage,o=e*j.usersPerPage;return{results:r.slice(n,o),count:r.length}}function G(){var e;return JSON.parse(null!=(e=sessionStorage.getItem(j.storageKeys.userService))?e:"null")}async function X(e){await O.deleteCache().catch(console.error),sessionStorage.setItem(j.storageKeys.userService,JSON.stringify(e))}async function Q(){await O.deleteCache().catch(console.error),sessionStorage.removeItem(j.storageKeys.userService)}async function Z(e){const t="/cars",a=await O.getCacheData(t),r=a&&a.find((t=>t.objectId===e));if(r)return r;const n=await _(K.CAR_BY_ID(e));if(a){const e=[n,...a].sort(((e,t)=>+new Date(t.createdAt)-+new Date(e.createdAt)));await O.updateCacheData(t,JSON.parse(JSON.stringify(e)))}return n}async function ee(e){var t;const a=await x(K.CAR_BY_ID(e)),r="/cars",n=(null!=(t=await O.getCacheData(r))?t:[]).filter((t=>t.objectId!==e));return await(n.length>0?O.updateCacheData(r,JSON.parse(JSON.stringify(n))):O.clearCacheData(r)),a}const te=(e,t)=>{const a=Number(new Date(e.date))||Number(new Date(e.createdAt));return(Number(new Date(t.date))||Number(new Date(t.createdAt)))-a};async function ae(e,t){const a=JSON.stringify({car:{__type:"Pointer",className:"Car",objectId:e}}),r=`/cars/${e}/repairs`,n=await O.getCacheData(r);let o;if(n?o=n:(({results:o}=await _(W.ALL_REPAIRS_BY_CAR(a))),await O.updateCacheData(r,JSON.parse(JSON.stringify(o)))),!t)return{results:o,all:o};const i=10*(t-1),s=10*t;return{results:o.slice(i,s),all:o}}async function re(e,t){const a=`/cars/${e}/repairs`,r=await O.getCacheData(a),n=r&&r.find((e=>e.objectId===t));if(n)return n;const o=await _(W.REPAIR_BY_ID(t));if(r){const e=[o,...r].sort(te);await O.updateCacheData(a,JSON.parse(JSON.stringify(e)))}return o}async function ne(e){const{results:t}=await ae(e),a=t.map((({objectId:e})=>x(W.REPAIR_BY_ID(e)))),r=`/cars/${e}/repairs`;return await O.clearCacheData(r),Promise.all(a)}const oe=document.getElementById("site-content")||document.body,ie=document.querySelector("meta[name=viewport]"),se=["/user/login","/user/register"],ce=["/cars","/repairs"];function le(e,t={}){const{container:a,...r}=t,n=a&&(a instanceof HTMLElement||a instanceof DocumentFragment)?a:"string"==typeof a?document.querySelector(a):null;return u(e,n||oe,r)}f.register(...g);const de=(e,t)=>{const a=document.createElement("canvas");return new f(a,{type:"pie",data:{labels:e,datasets:[{data:t,label:"Печалба",...ge}]},options:be}),a},ue=(e,t)=>{const a=document.createElement("canvas");return new f(a,{type:"bar",data:{labels:e,datasets:[{data:t,label:"Ремонти",...ge}]},options:he}),a},pe=(e,t)=>p`<table role="table"><thead role="rowgroup"><tr role="row"><th role="columnheader">Име</th><th role="columnheader">Разглеждайте като потребител</th></tr></thead><tbody role="rowgroup">${e.map((e=>me(e,t)))}</tbody></table>`,me=(e,t)=>p`<tr role="row"><td role="cell" data-cell-content="Име">${e.username}</td><td role="cell" data-cell-content="Разглеждайте"><div class="buttons"><button data-button-type="success" @click=${a=>t(a,e)}><i class="material-icons">person_search</i></button></div></td></tr>`,fe=(e,t)=>{const a=(a,r)=>{const n=e===r||r<1||r>t,o="number"==typeof a&&e===r,i=n?"#":(e=>{const t=N({page:e.toString()});return`${window.location.pathname}?${t}`})(r);return p`<a .href=${i} .className=${`${n?"not-selectable":""} ${o?"active":""}`}>${a}</a>`};const r=a(p`<i class="material-icons">keyboard_double_arrow_left</i>`,1),n=a(p`<i class="material-icons">chevron_left</i>`,e-1),o=function(){const a=Math.floor(j.relativePageLinks/2),r=Math.min(Math.max(1,e-a),Math.max(1,t-j.relativePageLinks+1)),n=Math.max(Math.min(t,e+a),Math.min(t,j.relativePageLinks)),o=Math.min(n-r+1,t);return Array.from({length:o},((e,t)=>r+t))}().map((e=>a(e,e))),i=a(p`<i class="material-icons">chevron_right</i>`,e+1),s=a(p`<i class="material-icons">keyboard_double_arrow_right</i>`,t);return p`${r}${n}${o}${i}${s}`},ge={backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1},be={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Печалба на потребителите"},tooltip:{callbacks:{label:e=>{const t=e.label||"",a=e.parsed||0,r=(a/e.dataset.data.reduce(((e,t)=>e+t),0)*100).toFixed(2);return`${t}: ${L(a.toString())} (${r}%)`}}}}},he={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Брой ремонти на потребителите"}},scales:{y:{ticks:{stepSize:1},title:{display:!0,text:"Брой ремонти"}},x:{title:{display:!0,text:"Потребители"}}}},ye=(e,t)=>e.length>0?ve(e,t):p`<p class="empty">Нямаш добавени автомобили!</p>`,ve=(e,t)=>p`<table role="table"><thead role="rowgroup"><tr role="row"><th role="columnheader">Рама</th><th role="columnheader">Pегистрационен &numero;</th><th role="columnheader">Марка / Модел</th><th role="columnheader">Двигател</th><th role="columnheader">Име на клиента</th><th role="columnheader">Ремонти</th><th role="columnheader">Редакция</th><th role="columnheader">Изтриване</th></tr></thead><tbody role="rowgroup">${e.map((e=>we(e,t)))}</tbody></table>`,we=(e,t)=>p`<tr role="row"><td role="cell" data-cell-content="Рама">${e.vin}</td><td role="cell" data-cell-content="Pегистрационен &numero;">${e.registration}</td><td role="cell" data-cell-content="Марка / Модел">${e.make}</td><td role="cell" data-cell-content="Двигател">${e.engine}</td><td role="cell" data-cell-content="Име на клиента">${e.customerName}</td><td role="cell" data-cell-content="Ремонти"><div class="buttons"><a role="button" data-button-type="info" href="${m.base()}/cars/${e.objectId}/repairs"><i class="material-icons">car_repair</i></a></div></td><td role="cell" data-cell-content="Редакция"><div class="buttons"><a role="button" href="${m.base()}/cars/${e.objectId}/edit"><i class="material-icons">edit</i></a></div></td><td role="cell" data-cell-content="Изтриване"><div class="buttons"><button data-button-type="danger" @click=${a=>t(a,e)}><i class="material-icons">delete_forever</i></button></div></td></tr>`,_e=(e,t,a,r)=>{const n=(n,o)=>{const i=e===o||o<1||o>t,s="number"==typeof n&&e===o,c=i?"#":(e=>{const t=N({filter:a,query:r,page:e.toString()});return`${window.location.pathname}?${t}`})(o);return p`<a .href=${c} .className=${`${i?"not-selectable":""} ${s?"active":""}`}>${n}</a>`};const o=n(p`<i class="material-icons">keyboard_double_arrow_left</i>`,1),i=n(p`<i class="material-icons">chevron_left</i>`,e-1),s=function(){const a=Math.floor(j.relativePageLinks/2),r=Math.min(Math.max(1,e-a),Math.max(1,t-j.relativePageLinks+1)),n=Math.max(Math.min(t,e+a),Math.min(t,j.relativePageLinks)),o=Math.min(n-r+1,t);return Array.from({length:o},((e,t)=>r+t))}().map((e=>n(e,e))),c=n(p`<i class="material-icons">chevron_right</i>`,e+1),l=n(p`<i class="material-icons">keyboard_double_arrow_right</i>`,t);return p`${o}${i}${s}${c}${l}`},$e=e=>e.length>0?Ce(e):p`<p class="empty">Нямаш завършени ремонти!</p>`,Ce=e=>p`<table role="table"><thead role="rowgroup"><tr role="row"><th role="columnheader">Извършен на</th><th role="columnheader">Километри</th><th role="columnheader">Детайли по ремонта</th></tr></thead><tbody role="rowgroup">${e.map(xe)}</tbody></table>`,xe=e=>p`<tr role="row"><td role="cell" data-cell-content="Извършен на">${E(e.date)}</td><td role="cell" data-cell-content="Километри">${e.km}</td><td role="cell" data-cell-content="Детайли по ремонта"><div class="buttons"><a role="button" data-button-type="info" href="${m.base()}/cars/${e.car.objectId}/repairs/${e.objectId}">Детайли</a></div></td></tr>`,ke=(e,t)=>{const a=(a,r)=>{const n=e===r||r<1||r>t,o="number"==typeof a&&e===r,i=n?"#":(e=>{const t=N({page:e.toString()});return`${window.location.pathname}?${t}`})(r);return p`<a .href=${i} .className=${`${n?"not-selectable":""} ${o?"active":""}`}>${a}</a>`};const r=a(p`<i class="material-icons">keyboard_double_arrow_left</i>`,1),n=a(p`<i class="material-icons">chevron_left</i>`,e-1),o=function(){const a=Math.floor(j.relativePageLinks/2),r=Math.min(Math.max(1,e-a),Math.max(1,t-j.relativePageLinks+1)),n=Math.max(Math.min(t,e+a),Math.min(t,j.relativePageLinks)),o=Math.min(n-r+1,t);return Array.from({length:o},((e,t)=>r+t))}().map((e=>a(e,e))),i=a(p`<i class="material-icons">chevron_right</i>`,e+1),s=a(p`<i class="material-icons">keyboard_double_arrow_right</i>`,t);return p`${r}${n}${o}${i}${s}`};function Ie(e,t){e.preventDefault();m.base(`/Car-Service/admin/${t.objectId}`),m.redirect("/cars")}async function Ne(){return(await async function(){return(await _(W.ALL_REPAIRS)).results}()).reduceRight(((e,t)=>{const a=t.owner.username;return e[a]||(e[a]={profit:0,count:0}),e[a].profit+=parseFloat(t.profit||"0"),e[a].count++,e}),{})}async function Se(e){e.preventDefault();const t=e.target,[a,r]=S(t);try{r(!0),V.showLoading({type:"cube-zoom"});const e=await async function(e){const t=await $(H.LOGIN,e),{result:a}=t,r=a.roles.includes("Admin");return await X({username:e.username,id:a.objectId,token:a.sessionToken,isSuperUser:r}),F(),{isSuperUser:r,...a}}(a),t=e.isSuperUser?"/admin":"/cars";m.redirect(t)}catch(n){const e=n instanceof Error?n.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{r(!1),V.hideLoading(),t.reset()}}function Ae(e){e.preventDefault();const t=e.target,a=t.previousElementSibling,r="password"===a.type?"text":"password";a.setAttribute("type",r),t.textContent="password"===r?"visibility_off":"visibility"}async function Re(e){e.preventDefault();const t=e.target,[{username:a,password:r,repass:n},o]=S(t);if(r===n)try{o(!0),V.showLoading({type:"cube-zoom"}),await async function(e){const t=await $(H.REGISTER,e);return await X({username:e.username,id:t.objectId,token:t.sessionToken}),F(),{username:e.username,updatedAt:t.createdAt,roles:[],...t}}({username:a,password:r}),m.redirect("/cars")}catch(i){const e=i instanceof Error?i.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{o(!1),V.hideLoading(),t.reset()}else V.showToast({text:"Паролите не съвпадат!",type:"warning"})}function De(e){var t,a,r;e.preventDefault();const n=e.target,o=n.previousElementSibling,i=null==(r=null==(a=null==(t=n.parentElement)?void 0:t.parentElement)?void 0:a.nextElementSibling)?void 0:r.lastElementChild,s="password"===o.type?"text":"password";o.setAttribute("type",s),i.setAttribute("type",s),n.textContent="password"===s?"visibility_off":"visibility"}function Le(e){e.preventDefault();const t=document.getElementById("search-options").value.trim(),a=document.getElementById("search-input").value.trim();t&&a?m.redirect(`/cars?${N({filter:t,query:a})}`):m.redirect("/cars")}async function Ee(e,t){e.preventDefault();if(await new Promise((e=>V.showModal({message:`Сигурен ли си, че искаш да изтриеш автомобила на ${t.customerName} - "${t.registration}"`,onConfirm:()=>e(!0),onCancel:()=>e(!1)}))))try{V.showLoading(),await Promise.all([ne(t.objectId),ee(t.objectId)]),V.showToast({text:`Успешно изтрихте автомобила на ${t.customerName} - "${t.registration}"`,type:"info"})}catch(a){const e=a instanceof Error?a.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{V.hideLoading(),m.redirect("/cars")}}class Pe{constructor(e={}){this._doc=new h(e),Object.assign(this,this._doc)}async applyFont(){const e=await async function(e){if(k.has(e))return k.get(e);const t=await fetch(`/Car-Service/assets/fonts/${e}`,{mode:"no-cors"}),a=await t.blob(),r=await new Promise(((e,t)=>{const r=new FileReader;r.readAsDataURL(a),r.onloadend=()=>e(r.result),r.onerror=t})),n=e.split(".").pop(),o=r.slice(`data:font/${n};base64,`.length);return k.set(e,o),o}("Roboto-Regular.ttf");this._doc.addFileToVFS("Roboto-Regular.ttf",e),this._doc.addFont("Roboto-Regular.ttf","Roboto","normal"),this._doc.setFont("Roboto")}addHeader(){return this._doc.text("Автомобилен сервиз",105,10,{align:"center"}),this._doc.setFontSize(14),this._doc.text('ул. "Цар Симеон" 99',105,16,{align:"center"}),this._doc.text("София, България",105,22,{align:"center"}),this._doc.text("Телефон: 0888 888 888",105,28,{align:"center"}),this._doc.setFontSize(16),this}addFooter(){return this._doc.setFontSize(12),this._doc.text("Предаващ: ........................",20,285,{align:"left"}),this._doc.text("Получател: ........................",140,285,{align:"left"}),this}generateCarTable(e,t={}){return y(this._doc,{theme:"grid",head:[["Име на клиента","VIN","Pегистрационен номер","Марка / Модел","Двигател"]],body:e,margin:{top:45},styles:{font:"Roboto",textColor:[35,68,101]},headStyles:{fillColor:[35,68,101],textColor:255},alternateRowStyles:{fillColor:[238,238,238]},tableLineWidth:.5,tableLineColor:[35,68,101],...t}),this}generateRepairTable(e,t={}){return y(this._doc,{theme:"grid",head:[["Дата на ремонт","Постъпващи километри","Платена сума","Забележка"]],body:e,margin:{top:45},styles:{font:"Roboto",textColor:[35,68,101]},headStyles:{fillColor:[35,68,101],textColor:255},alternateRowStyles:{fillColor:[238,238,238]},tableLineWidth:.5,tableLineColor:[35,68,101],...t}),this}}async function Te(e,t,a){if(e.preventDefault(),!t||!(null==a?void 0:a.length))return;const r=[[t.customerName,t.vin,t.registration,t.make,t.engine]],n=a.map((e=>[T(e.date),`${e.km} km`,L(e.profit),e.description])),o=new Pe;await o.applyFont(),o.addHeader().generateCarTable(r).generateRepairTable(n).addFooter().save(`Всични ремонти на ${t.customerName}.pdf`)}null==(i=document.getElementById("logout-button"))||i.addEventListener("click",(async function(e){if(e.preventDefault(),await new Promise((e=>V.showModal({message:"Сигурен ли си, че искаш да излезеш?",title:"Изход",onConfirm:()=>e(!0),onCancel:()=>e(!1)}))))try{V.showLoading({type:"cube-zoom"}),await async function(){const e=await $(H.LOGOUT,{});return await Q(),F(),e}(),m.base("/Car-Service"),m.redirect("/user/login")}catch(t){const e=t instanceof Error?t.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{V.hideLoading()}})),m.base("/Car-Service"),m((function(e,t){const a=Object.assign(e,{root:oe,render:le});!function(e){const{origin:t,pathname:a,search:r}=window.location,n=t+e.pathname,o=ce.some((e=>a.endsWith(e))),i=G();if(i&&i.isSuperUser){const t=e.pathname.match(/\/admin\/([^/]+)/);t&&(e.params.userId=t[1])}o&&n!==t+a&&(e.state.prev=a+r)}(a),function(e){const{path:t}=e,a="interactive-widget=resizes-content";if(!ie){const e=document.createElement("meta");return e.name="viewport",e.content=a,void document.head.appendChild(e)}const r=ie.content.split(",").map((e=>e.trim()));se.includes(t)&&!r.includes(a)?r.push(a):!se.includes(t)&&r.includes(a)&&r.splice(r.indexOf(a),1);ie.content=r.join(", ")}(a),F(a),function(e){if(!e)return;if(!document.startViewTransition)return void e();document.startViewTransition(e)}((()=>{const a=!!sessionStorage.getItem(j.storageKeys.userService),r=!a&&!se.includes(e.path),n=a&&se.includes(e.path);r?e.page.redirect(se[0]):n?window.history.back():t()}))})),m("/user/login",(function(e){e.render(p`<section id="auth-page"><form @submit=${Se}><fieldset class="input-fields"><legend>Вход</legend><div class="field"><label for="user__username">Потребителско име: <span class='required'>*</span></label><input name="username" id="user__username" type="text" placeholder="Въведи потребителско име..." autocomplete="username" required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="user__password">Парола: <span class='required'>*</span></label><div class="password-field"><input name="password" id="user__password" type="password" placeholder="Въведи парола..."     autocomplete="current-password" required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /><i class="material-icons eye-icon" @click=${Ae}>visibility_off</i></div></div><div class="buttons"><input role="button" data-button-type="info" type="submit" value="Вход" /></div><div class="form-link"><span>Все още нямаш профил? <a href="${m.base()}/user/register">Регистрация</a></span></div></fieldset></form></section>`)})),m("/user/register",(function(e){e.render(p`<section id="auth-page"><form @submit=${Re}><fieldset class="input-fields"><legend>Регистрация</legend><div class="field"><label for="user__username">Потребителско име: <span class='required'>*</span></label><input name="username" id="user__username" type="text" placeholder="Въведи потребителско име..." required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="user__password">Парола: <span class='required'>*</span></label><div class="password-field"><input name="password" id="user__password" type="password" placeholder="Въведи парола..." required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /><i class="material-icons eye-icon" @click=${De}>visibility_off</i></div></div><div class="field"><label for="user__repass">Потвърди паролата: <span class='required'>*</span></label><input name="repass" id="user__repass" type="password" placeholder="Повтори паролата..." required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="buttons"><input role="button" data-button-type="info" type="submit" value="Регистрация" /></div><div class="form-link"><span>Вече имаш създаден профил? <a href="${m.base()}/user/login">Вход</a></span></div></fieldset></form></section>`)})),m("/admin",(async function(e){m.base("/Car-Service");const{page:t="1"}=I(e.querystring);e.render(b((async()=>{const e=await async function(e){try{const[{results:t,count:a},r]=await Promise.all([Y(e),Ne()]);return{users:t,numberOfUsers:a,repairs:r,pageNumber:e}}catch(t){const e=t instanceof Error?t.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{V.hideLoading()}}(Number(t));if(e)return(e=>{const{users:t,numberOfUsers:a,repairs:r,pageNumber:n,onBrowseAsUser:o}=e,i=Math.max(Math.ceil(a/j.usersPerPage),1),s=Object.keys(r),c=Object.values(r);return p`<section id="admin-page"><span class="title">Aдминистраторско табло</span><div class="container"><div class="chart">${ue(s,c.map((e=>e.count)))}</div><div class="chart">${de(s,c.map((e=>e.profit)))}</div></div>${pe(t,o)}<div class="pagination">${fe(n,i)}</div></section>`})({...e,onBrowseAsUser:Ie})})(),V.showLoading()))})),m(["/cars","/admin/:userId/cars"],(function(e){const{page:t="1",filter:a="",query:r=""}=I(e.querystring);e.render(b((async()=>{const n=await async function(e,t,a,r){try{const{results:n,count:o}=await async function(e,t,a,r){const n=t&&a?JSON.stringify({[t]:{$regex:`(?i)${a}`}}):null,o=r?JSON.stringify({owner:{__type:"Pointer",className:"_User",objectId:r}}):null,i="/cars",s=await O.getCacheData(i);let c;if(n?({results:c}=await _(K.ALL_CARS(n.concat(null!=o?o:"")))):(c=null!=s?s:(await _(K.ALL_CARS(null!=o?o:""))).results,s||await O.updateCacheData(i,c)),!e)return{results:c,count:c.length};const l=(e-1)*j.itemsPerPage,d=e*j.itemsPerPage;return{results:c.slice(l,d),count:c.length}}(e,t,a,r);return{cars:n,carsCount:o,pageNumber:e,searchCategory:t,searchQuery:a}}catch(n){const e=n instanceof Error?n.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"}),m.redirect("/")}finally{V.hideLoading()}}(Number(t)||1,a,r,e.params.userId);if(n)return(e=>{const{cars:t,carsCount:a,pageNumber:r,searchCategory:n,searchQuery:o,onSearch:i,onDelete:s}=e,c=Math.max(Math.ceil(a/j.itemsPerPage),1);return p`<section id="catalog-page"><form autocomplete="off"><fieldset><legend>Всички автомобили</legend><fieldset class="search"><label for="search-options" id="search-label" aria-hidden="true">Търсачка</label><select id="search-options" aria-labelledby="search-label"><option value="registration" .selected=${"registration"===n}>Регистрационен &numero;</option><option value="make" .selected=${"make"===n}>Марка</option><option value="engine" .selected=${"engine"===n}>Двигател</option><option value="customerName" .selected=${"customerName"===n}>Име на клиента</option></select><input id="search-input" type="search" placeholder="Въведи..." .value=${o} /><button @click=${i}>Търси</button></fieldset>${ye(t,s)}<fieldset class="pagination">${_e(r,c,n,o)}</fieldset></fieldset></form></section>`})({...n,onSearch:Le,onDelete:Ee})})(),V.showLoading()))})),m(["/cars/create","/admin/:userId/cars/create"],(function(e){const{prev:t=`${m.base()}/cars`}=e.state;e.render((e=>{const{prev:t,onSubmit:a}=e;return p`<section id="create-page"><form @submit=${a} autocomplete="off"><fieldset><legend>Добави автомобил</legend><fieldset class="input-fields"><div class="field"><label for="car__vin">VIN:</label><input name="vin" id="car__vin" type="text" /></div><div class="field"><label for="car__registration">Pегистрационен &numero;: <span class='required'>*</span></label><input name="registration" id="car__registration" type="text" required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="car__make">Марка / Модел:</label><input name="make" id="car__make" type="text" /></div><div class="field"><label for="car__engine">Двигател:</label><input name="engine" id="car__engine" type="text" /></div><div class="field"><label for="car__customer">Име на клиента: <span class='required'>*</span></label><input name="customerName" id="car__customer" type="text" required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div></fieldset><div class="buttons"><button data-button-type="success" type="submit">Добави</button><a role="button" data-button-type="danger" href="${t}">Отказ</a></div></fieldset></form></section>`})({prev:t,onSubmit:t=>async function(e,t){e.preventDefault();const a=e.target,[r,n]=S(a);try{n(!0),V.showLoading(),await async function(e,t){var a;const{id:r}=t?{id:t}:G(),n={owner:Object.freeze({__type:"Pointer",className:"_User",objectId:r})},o=Object.assign({},e,n),i=await $(K.CREATE_CAR,o),s="/cars",c=null!=(a=await O.getCacheData(s))?a:[],l={...o,...i};if(t)return l;const d=[l,...c].sort(((e,t)=>+new Date(t.createdAt)-+new Date(e.createdAt)));return await O.updateCacheData(s,JSON.parse(JSON.stringify(d))),l}(r,t),V.showToast({text:`Успешно създадохте автомобил на ${r.customerName} - "${r.registration}"`,type:"success"})}catch(o){const e=o instanceof Error?o.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{n(!1),V.hideLoading(),a.reset(),m.redirect("/cars")}}(t,e.params.userId)}))})),m(["/cars/:carId/edit","admin/:userId/cars/:carId/edit"],(function(e){const{carId:t}=e.params,{prev:a=`${m.base()}/cars`}=e.state;e.render(b((async()=>{const e=await async function(e){try{return await Z(e)}catch(t){const e=t instanceof Error?t.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"}),m.redirect("/cars")}finally{V.hideLoading()}}(t);if(e)return(e=>{const{car:t,prev:a,onSubmit:r}=e;return p`<section id="edit-page"><form @submit=${r} autocomplete="off"><fieldset><legend>Редактирай автомобил</legend><fieldset class="input-fields"><div class="field"><label for="car__vin">VIN:</label><input name="vin" id="car__vin" type="text" .value=${t.vin} /></div><div class="field"><label for="car__registration">Pегистрационен &numero;: <span class='required'>*</span></label><input name="registration" id="car__registration" type="text" .value=${t.registration} required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="car__make">Марка / Модел:</label><input name="make" id="car__make" type="text" .value=${t.make} /></div><div class="field"><label for="car__engine">Двигател:</label><input name="engine" id="car__engine" type="text" .value=${t.engine} /></div><div class="field"><label for="car__customer">Име на клиента: <span class='required'>*</span></label><input name="customerName" id="car__customer" type="text" .value=${t.customerName} required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div></fieldset><div class="buttons"><button data-button-type="info" type="submit">Запази промените</button><a role="button" data-button-type="danger" href="${a}">Отказ</a></div></fieldset></form></section>`})({car:e,prev:a,onSubmit:t=>async function(e,t){e.preventDefault();const a=e.target,[r,n]=S(a);try{n(!0),V.showLoading(),await async function(e,t){var a;const r=await C(K.CAR_BY_ID(e),t),n="/cars",o=null!=(a=await O.getCacheData(n))?a:[],i=o.findIndex((t=>t.objectId===e)),s={...-1!==i?o.splice(i,1)[0]:{},...t,...r},c=[s,...o].sort(((e,t)=>+new Date(t.createdAt)-+new Date(e.createdAt)));return await O.updateCacheData(n,JSON.parse(JSON.stringify(c))),s}(t.objectId,r),V.showToast({text:`Успешно редактирахте ремонт на ${r.customerName} - "${r.registration}"`,type:"info"})}catch(o){const e=o instanceof Error?o.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{n(!1),V.hideLoading(),a.reset(),m.redirect("/cars")}}(t,e)})})(),V.showLoading()))})),m(["/cars/:carId/repairs","admin/:userId/cars/:carId/repairs"],(function(e){const{carId:t}=e.params,{page:a="1"}=I(e.querystring),{prev:r=`${m.base()}/cars`}=e.state;e.render(b((async()=>{const e=await async function(e,t){try{const[{results:a,all:r},n]=await Promise.all([ae(e,t),Z(e)]);return{repairs:a,allRepairs:r,car:n,pageNumber:t}}catch(a){const e=a instanceof Error?a.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"}),m.redirect("/cars")}finally{V.hideLoading()}}(t,Number(a)||1);if(e)return(e=>{const{repairs:t,allRepairs:a,car:r,pageNumber:n,prev:o,onExport:i}=e,s=Math.max(Math.ceil(a.length/j.itemsPerPage),1);return p`<section id="catalog-page"><form autocomplete="off"><fieldset><legend>Всичките ремонти на ${r.customerName} - "${r.registration}"</legend><fieldset class="search"><div class="buttons"><a role="button" data-button-type="success" href="${m.base()}/cars/${r.objectId}/repairs/create">Добави ремонт</a><button data-button-type="info" @click=${e=>i(e,r,a)}>Експорт</button><a role="button" href="${o}">Назад</a></div></fieldset>${$e(t)}<fieldset class="pagination">${ke(n,s)}</fieldset></fieldset></form></section>`})({...e,prev:r,onExport:Te})})(),V.showLoading()))})),m(["/cars/:carId/repairs/create","admin/:userId/cars/:carId/repairs/create"],(function(e){const{carId:t,userId:a}=e.params,{prev:r=`${m.base()}/cars/${t}/repairs`}=e.state;e.render((e=>{const{prev:t,onSubmit:a}=e;return p`<section id="create-page"><form @submit=${a} autocomplete="off"><fieldset><legend>Добави ремонт</legend><fieldset class="input-fields"><div class="field"><label for="repair__date">Датa на ремонта: <span class='required'>*</span></label><input name="date" id="repair__date" type="date" .value="${T()}" style="cursor: pointer;" required @click="${({target:e})=>e.showPicker()}" @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="repair__km">Километри: <span class='required'>*</span></label><input name="km" id="repair__km" type="number" required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="repair__profit">Платена сума:</label><input name="profit" id="repair__profit" type="text" /></div><div class="field"><label for="repair__description">Забележка:</label><textarea data-scrollbar name="description" id="repair__description" @keyup="${({target:e})=>{e.scrollHeight>e.clientHeight&&e.style.setProperty("height",e.scrollHeight+"px")}}"></textarea></div></fieldset><div class="buttons"><button data-button-type="success" type="submit">Добави</button><a role="button" data-button-type="danger" href="${t}">Отказ</a></div></fieldset></form></section>`})({prev:r,onSubmit:e=>async function(e,t,a){e.preventDefault();const r=e.target,[n,o]=S(r);n.date=P(n.date);try{o(!0),V.showLoading(),await async function(e,t,a){var r;const{id:n}=a?{id:a}:G(),o={owner:Object.freeze({__type:"Pointer",className:"_User",objectId:n})},i={car:Object.freeze({__type:"Pointer",className:"Car",objectId:e})},s=Object.assign({},t,o,i),c=await $(W.CREATE_REPAIR,s),l=`/cars/${e}/repairs`,d=null!=(r=await O.getCacheData(l))?r:[],u={...s,...c},p=[u,...d].sort(te);return await O.updateCacheData(l,JSON.parse(JSON.stringify(p))),u}(t,n,a),V.showToast({text:"Успешно добавихте ремонт",type:"success"})}catch(i){const e=i instanceof Error?i.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{o(!1),V.hideLoading(),r.reset(),m.redirect(`/cars/${t}/repairs`)}}(e,t,a)}))})),m(["/cars/:carId/repairs/:repairId","admin/:userId/cars/:carId/repairs/:repairId"],(function(e){const{carId:t,repairId:a}=e.params,{prev:r=`${m.base()}/cars/${t}/repairs`}=e.state;e.render(b((async()=>{const e=await async function(e,t){try{return await re(e,t)}catch(a){const t=a instanceof Error?a.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:t,type:"error"}),m.redirect(`/cars/${e}/repairs`)}finally{V.hideLoading()}}(t,a);if(e)return(e=>{const{repair:t,prev:a,onExport:r,onDelete:n}=e;return p`<section id="details-page"><form autocomplete="off"><fieldset><legend>Детайли по ремонта</legend><fieldset class="input-fields"><legend>Обща информация</legend><div class="field"><label for="repair__date">Датa на ремонта:</label><input disabled name="date" id="repair__date" .value=${E(t.date)} /></div><div class="field"><label for="repair__km">Километри:</label><input disabled name="km" id="repair__km" .value=${t.km} /></div><div class="field"><label for="repair__profit">Платена сума:</label><input disabled name="profit" id="repair__profit" .value=${t.profit} /></div></fieldset><fieldset disabled class="input-fields"><legend>Информация за ремонта</legend><div class="field"><label for="repair__description">Забележка:</label><textarea data-scrollbar name="description" id="repair__description" .value=${t.description}></textarea></div></fieldset><div class="buttons"><a role="button" data-button-type="info" href="${m.base()}/cars/${t.car.objectId}/repairs/${t.objectId}/edit">Редактирай</a><a role="button" href="${a}">Назад</a><button data-button-type="info" @click=${r}>Експорт</button><button data-button-type="danger" @click=${n}>Изтрий</button></div></fieldset></form></section>`})({repair:e,prev:r,onExport:t=>async function(e,t){if(e.preventDefault(),!t)return;const a=await Z(t.car.objectId);if(!a)return;const r=[[a.customerName,a.vin,a.registration,a.make,a.engine]],n=[[T(t.date),`${t.km} km`,L(t.profit),t.description]],o=new Pe;await o.applyFont(),o.addHeader().generateCarTable(r).generateRepairTable(n).addFooter().save(`Ремонт на ${a.customerName} от ${T(t.date)}.pdf`)}(t,e),onDelete:t=>async function(e,t){e.preventDefault();if(!(await new Promise((e=>V.showModal({message:`Сигурен ли си, че искаш да изтриеш ремонт от дата "${t.date}"`,onConfirm:()=>e(!0),onCancel:()=>e(!1)})))))return;try{V.showLoading(),await async function(e,t){var a;const r=await x(W.REPAIR_BY_ID(t)),n=`/cars/${e}/repairs`,o=(null!=(a=await O.getCacheData(n))?a:[]).filter((e=>e.objectId!==t));return await(o.length>0?O.updateCacheData(n,JSON.parse(JSON.stringify(o))):O.clearCacheData(n)),r}(t.car.objectId,t.objectId),V.showToast({text:"Успешно изтрихте ремонта",type:"info"})}catch(a){const e=a instanceof Error?a.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{V.hideLoading(),m.redirect(`/cars/${t.car.objectId}/repairs`)}}(t,e)})})(),V.showLoading()))})),m(["/cars/:carId/repairs/:repairId/edit","admin/:userId/cars/:carId/repairs/:repairId/edit"],(function(e){const{carId:t,repairId:a}=e.params;e.render(b((async()=>{const e=await async function(e,t){try{return await re(e,t)}catch(a){const t=a instanceof Error?a.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:t,type:"error"}),m.redirect(`/cars/${e}/repairs`)}finally{V.hideLoading()}}(t,a);if(e)return(e=>{const{repair:t,onSubmit:a}=e;return p`<section id="edit-page"><form @submit=${a} autocomplete="off"><fieldset><legend>Редактирай ремонт</legend><fieldset class="input-fields"><div class="field"><label for="repair__date">Датa на ремонта: <span class='required'>*</span></label><input name="date" id="repair__date" type="date" .value=${T(t.date)} style="cursor: pointer;" required @click="${({target:e})=>e.showPicker()}" @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="repair__km">Километри: <span class='required'>*</span></label><input name="km" id="repair__km" type="number" .value=${t.km} required @invalid="${({target:e})=>e.setCustomValidity("Полето е задължително!")}" @input="${({target:e})=>e.setCustomValidity("")}" /></div><div class="field"><label for="repair__profit">Платена сума:</label><input name="profit" id="repair__profit" type="text" .value=${t.profit} /></div><div class="field"><label for="repair__description">Забележка:</label><textarea data-scrollbar name="description" id="repair__description" .value=${t.description} @keyup="${({target:e})=>{e.scrollHeight>e.clientHeight&&e.style.setProperty("height",e.scrollHeight+"px")}}"></textarea></div></fieldset><div class="buttons"><button data-button-type="success" type="submit">Запази промените</button><a role="button" data-button-type="danger" href="${m.base()}/cars/${t.car.objectId}/repairs/${t.objectId}">Отказ</a></div></fieldset></form></section>`})({repair:e,onSubmit:t=>async function(e,t){e.preventDefault();const a=e.target,[r,n]=S(a),o=r.date;r.date=P(r.date);try{n(!0),V.showLoading(),await async function(e,t,a){var r;const n=await C(W.REPAIR_BY_ID(t),a),o=`/cars/${e}/repairs`,i=null!=(r=await O.getCacheData(o))?r:[],s=i.findIndex((e=>e.objectId===t)),c={...-1!==s?i.splice(s,1)[0]:{},...a,...n},l=[c,...i].sort(te);return await O.updateCacheData(o,JSON.parse(JSON.stringify(l))),c}(t.car.objectId,t.objectId,r),V.showToast({text:`Успешно редактирахте ремонт от дата "${o}"`,type:"info"})}catch(i){const e=i instanceof Error?i.message:"Възникна грешка, моля опитайте по-късно";V.showToast({text:e,type:"error"})}finally{n(!1),V.hideLoading(),a.reset(),m.redirect(`/cars/${t.car.objectId}/repairs/${t.objectId}`)}}(t,e)})})(),V.showLoading()))})),m.start();
